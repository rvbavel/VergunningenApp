<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Speciaal Transport Zwolle B.V. - Ontheffingenrapport</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="print.css" media="print">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<header>
  <img src="logo.png" alt="Speciaal Transport Zwolle B.V." class="logo">
  <h1>ONTHEFFINGENRAPPORT</h1>
</header>

<nav class="top-menu">
  <button onclick="window.location.href='index.html'">üè† HOME</button>
  <button onclick="window.location.href='vergunningen.html'">INBOEKEN VERGUNNINGEN</button>
  <button onclick="window.location.href='ontheffingenrapport.html'">ONTHEFFINGEN RAPPORT</button>
  <button onclick="window.location.href='begeleidingenrapport.html'">BEGELEIDINGEN RAPPORT</button>
  <button onclick="window.location.href='transportbegeleiding.html'">AANVRAAG TRANSPORTBEGELEIDING</button>
</nav>

<main class="card">
  <h2>ONTHEFFINGEN RAPPORT</h2>

  <div class="form-grid">
    <label>Referentienummer:
      <div class="split-input">
        <span class="prefix">2025.</span>
        <input type="text" id="referentienummer" maxlength="4" placeholder="4 cijfers">
      </div>
    </label>
    <label>Behandelaar:
      <select id="behandelaar">
        <option value="">--- Maak keuze ---</option>
        <option value="Ren√©">Ren√©</option>
        <option value="Anke">Anke</option>
        <option value="Sia">Sia</option>
        <option value="Martijn">Martijn</option>
      </select>
    </label>
  </div>

  <div class="form-grid-three">
    <label>Opdrachtgever:
      <input type="text" id="opdrachtgever" placeholder="Naam opdrachtgever">
    </label>
    <label>Vervoerder:
      <input type="text" id="vervoerder" placeholder="Naam vervoerder">
    </label>
    <label>Referentie klant:
      <input type="text" id="referentie_klant" placeholder="Referentie klant">
    </label>
  </div>

  <div class="form-grid-single">
    <label>Omschrijving:
      <textarea id="omschrijving" placeholder="Ontheffing, Afmetingen, Kentekens, Ontheffingsnummer, Geldigheid"></textarea>
    </label>
  </div>

  <div class="form-grid-single">
    <label>Opmerkingen t.a.v. facturatie:
      <textarea id="opmerkingen_facturatie" placeholder="Bijvoorbeeld factuurreferenties of betaalafspraken"></textarea>
    </label>
  </div>

  <h3>Details per regel</h3>
  <div class="form-grid-five">
    <div>
      <label>Aangevraagd bij:</label>
      <input type="text"><input type="text"><input type="text"><input type="text">
      <input type="text"><input type="text"><input type="text"><input type="text">
    </div>
    <div>
      <label>Aanvraagdatum:</label>
      <input type="date"><input type="date"><input type="date"><input type="date">
      <input type="date"><input type="date"><input type="date"><input type="date">
    </div>
    <div>
      <label>Afgiftedatum:</label>
      <input type="date"><input type="date"><input type="date"><input type="date">
      <input type="date"><input type="date"><input type="date"><input type="date">
    </div>
    <div>
      <label>Inkoopprijs (‚Ç¨):</label>
      <input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal">
      <input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal">
    </div>
    <div>
      <label>Verkoopprijs (‚Ç¨):</label>
      <input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal">
      <input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal"><input type="text" inputmode="decimal">
    </div>
  </div>

  <div class="form-grid-three">
    <label>Inkoopprijs totaal (‚Ç¨):
      <input type="text" id="inkoop_totaal" readonly>
    </label>
    <label>Verkoopprijs totaal (‚Ç¨):
      <input type="text" id="verkoop_totaal" readonly>
    </label>
    <label>Marge (‚Ç¨):
      <input type="text" id="marge" readonly>
    </label>
  </div>

  <button onclick="genereerPDF()" class="primary-btn">üìÖ DOWNLOAD ALS PDF</button>
</main>

<footer>
  Ontwikkeld door Ren√© van Bavel ¬©2025 Speciaal Transport Zwolle B.V.
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function genereerPDF() {
  window.print();
}
</script>

<script>
function updateOntheffingenTotaal() {
  const inkoopInputs = document.querySelectorAll('.form-grid-five > div:nth-child(4) input');
  const verkoopInputs = document.querySelectorAll('.form-grid-five > div:nth-child(5) input');

  let inkoopTotaal = 0;
  let verkoopTotaal = 0;

  inkoopInputs.forEach((input) => {
    let val = input.value.trim();
    if (val !== '') {
      let number = parseFloat(val.replace(',', '.'));
      if (!isNaN(number)) {
        inkoopTotaal += number;
        input.value = number.toFixed(2).replace('.', ',');
      }
    }
  });

  verkoopInputs.forEach((input) => {
    let val = input.value.trim();
    if (val !== '') {
      let number = parseFloat(val.replace(',', '.'));
      if (!isNaN(number)) {
        verkoopTotaal += number;
        input.value = number.toFixed(2).replace('.', ',');
      }
    }
  });

  const marge = verkoopTotaal - inkoopTotaal;
  document.getElementById('inkoop_totaal').value = `‚Ç¨ ${inkoopTotaal.toFixed(2).replace('.', ',')}`;
  document.getElementById('verkoop_totaal').value = `‚Ç¨ ${verkoopTotaal.toFixed(2).replace('.', ',')}`;
  document.getElementById('marge').value = `‚Ç¨ ${marge.toFixed(2).replace('.', ',')}`;
}

document.addEventListener('blur', (e) => {
  if (e.target.closest('.form-grid-five')) {
    updateOntheffingenTotaal();
  }
}, true);

window.addEventListener('DOMContentLoaded', () => {
  updateOntheffingenTotaal();
});
</script>

<script>
async function genereerPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const get = id => document.getElementById(id)?.value || "";

  doc.setFontSize(14);
  doc.text("Speciaal Transport Zwolle B.V.", 20, 20);
  doc.setFontSize(12);
  doc.text("ONTHEFFINGEN RAPPORT", 20, 28);

  doc.setFontSize(10);
  let y = 40;
  doc.text(`Referentienummer: 2025.${get("referentienummer")}`, 20, y);
  doc.text(`Behandelaar: ${get("behandelaar")}`, 120, y);
  y += 8;
  doc.text(`Opdrachtgever: ${get("opdrachtgever")}`, 20, y);
  doc.text(`Vervoerder: ${get("vervoerder")}`, 120, y);
  y += 8;
  doc.text(`Referentie klant: ${get("referentie_klant")}`, 20, y);
  y += 10;

  doc.text("Omschrijving:", 20, y);
  y += 6;
  doc.text(get("omschrijving"), 25, y, { maxWidth: 170 });
  y += 12;

  doc.text("Opmerkingen t.a.v. facturatie:", 20, y);
  y += 6;
  doc.text(get("opmerkingen_facturatie"), 25, y, { maxWidth: 170 });
  y += 12;

  doc.setFont("helvetica", "bold");
  const headers = ["Aangevraagd bij", "Aanvraagdatum", "Afgiftedatum", "Inkoop (‚Ç¨)", "Verkoop (‚Ç¨)"];
  const xCoords = [20, 70, 110, 150, 180];
  doc.setFillColor(220, 220, 220);
xCoords.forEach((x, i) => {
  doc.rect(x - 1, y - 4.5, (i === 0 ? 45 : (xCoords[i+1] || 200) - x - 2), 7, "F");
});
headers.forEach((h, i) => doc.text(h, xCoords[i], y));
  doc.setFont("helvetica", "normal");
  y += 6;

  const rows = document.querySelectorAll("table.details-tabel tbody tr");
  
  rows.forEach(row => {
    const inputs = row.querySelectorAll("input");
    const values = Array.from(inputs).map(inp => inp.value.trim());
    if (values.some(val => val !== "")) {
      values.forEach((val, i) => doc.text(val || "...", xCoords[i], y));
      y += 6;
    }
  });


  y += 5;
    
  doc.setFont("helvetica", "bold");
  doc.setFontSize(11);
  doc.text("Totaal inkoop: " + get("inkoop_totaal") + "    Totaal verkoop: " + 
    get("verkoop_totaal") + "    Marge: " + get("marge"), 20, y);
  doc.setFontSize(10);
  doc.setFont("helvetica", "normal");

  doc.text("Totaal verkoop: " + get("verkoop_totaal"), 90, y);
  doc.text("Marge: " + get("marge"), 160, y);

  const filename = "2025." + get("referentienummer").trim() || "rapport";
  doc.save(filename + ".pdf");
}
</script>

</body>
</html>

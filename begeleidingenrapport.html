<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Speciaal Transport Zwolle B.V. - Begeleidingenrapport</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="print.css" media="print">
</head>
<body>

<header>
  <img src="logo.png" alt="Speciaal Transport Zwolle B.V." class="logo">
  <h1>BEGELEIDINGENRAPPORT</h1>
</header>
  
   <nav class="top-menu">
    <button onclick="window.location.href='index.html'">üè† HOME</button>
    <button onclick="window.location.href='vergunningen.html'">INBOEKEN VERGUNNINGEN</button>
    <button onclick="window.location.href='ontheffingenrapport.html'">ONTHEFFINGEN RAPPORT</button>
    <button onclick="window.location.href='begeleidingenrapport.html'">BEGELEIDINGEN RAPPORT</button>
    <button onclick="window.location.href='transportbegeleiding.html'">AANVRAAG TRANSPORTBEGELEIDING</button>
    <button id="admin-gebruikersbeheer" onclick="window.location.href='gebruikersbeheer.html'" style="display:none;">GEBRUIKERSBEHEER</button>
    <button id="admin-statistieken" onclick="window.location.href='statistieken.html'" style="display:none;">STATISTIEKEN</button>
  </nav>

<main class="card">
  <h2>BEGELEIDINGEN RAPPORT</h2>

  <div class="form-grid">
    <label>Referentienummer:
      <div class="split-input">
        <span class="prefix">2025.</span>
        <input type="text" id="referentienummer" maxlength="4">
      </div>
    </label>
    <label>Behandelaar:
      <select id="behandelaar">
        <option value="">--- Maak keuze ---</option>
        <option value="Ren√©">Ren√©</option>
        <option value="Anke">Anke</option>
        <option value="Sia">Sia</option>
        <option value="Martijn">Martijn</option>
      </select>
    </label>
  </div>

  <div class="form-grid-three">
    <label>Opdrachtgever:
      <input type="text" id="opdrachtgever">
    </label>
    <label>Vervoerder:
      <input type="text" id="vervoerder">
    </label>
    <label>Referentie klant:
      <input type="text" id="referentie_klant">
    </label>
  </div>

  <div class="form-grid-single">
    <label>Omschrijving:
      <textarea id="omschrijving"></textarea>
    </label>
  </div>

  <div class="form-grid-single">
    <label>Opmerkingen t.a.v. facturatie:
      <textarea id="opmerkingen_facturatie"></textarea>
    </label>
  </div>

  <h3>Details per regel</h3>
  <div class="form-grid-seven">
    <div>
      <label>Begeleidingsfirma:</label>
      <input type="text" value="Bemiddeling STZ"><input><input><input><input><input><input><input>
    </div>
    <div>
      <label>Transportdatum:</label>
      <input type="date"><input type="date"><input type="date"><input type="date">
      <input type="date"><input type="date"><input type="date"><input type="date">
    </div>
    <div>
      <label>Van:</label>
      <input><input><input><input><input><input><input><input>
    </div>
    <div>
      <label>Naar:</label>
      <input><input><input><input><input><input><input><input>
    </div>
    <div>
      <label>Uren:</label>
      <input type="number"><input type="number"><input type="number"><input type="number">
      <input type="number"><input type="number"><input type="number"><input type="number">
    </div>
    <div>
      <label>Inkoopprijs (‚Ç¨):</label>
      <input type="text" data-type="inkoop"><input type="text" data-type="inkoop">
      <input type="text" data-type="inkoop"><input type="text" data-type="inkoop">
      <input type="text" data-type="inkoop"><input type="text" data-type="inkoop">
      <input type="text" data-type="inkoop"><input type="text" data-type="inkoop">
    </div>
    <div>
      <label>Verkoopprijs (‚Ç¨):</label>
      <input type="text" data-type="verkoop"><input type="text" data-type="verkoop">
      <input type="text" data-type="verkoop"><input type="text" data-type="verkoop">
      <input type="text" data-type="verkoop"><input type="text" data-type="verkoop">
      <input type="text" data-type="verkoop"><input type="text" data-type="verkoop">
    </div>
  </div>

  <div class="form-grid-three">
    <label>Inkoopprijs totaal (‚Ç¨):
      <input type="text" id="inkoop_totaal" readonly>
    </label>
    <label>Verkoopprijs totaal (‚Ç¨):
      <input type="text" id="verkoop_totaal" readonly>
    </label>
    <label>Marge (‚Ç¨):
      <input type="text" id="marge" readonly>
    </label>
  </div>

  <button onclick="genereerPDF()" class="primary-btn">üì• OPSLAAN ALS PDF</button>
</main>

<script>
function formatEuro(value) {
  const number = parseFloat(value);
  if (isNaN(number)) return '';
  return number.toFixed(2).replace('.', ',');
}

function parseEuroString(value) {
  return parseFloat(value.replace(',', '.').replace('‚Ç¨', '').trim()) || 0;
}

function updateTotals() {
  const inkoopInputs = document.querySelectorAll('input[data-type="inkoop"]');
  const verkoopInputs = document.querySelectorAll('input[data-type="verkoop"]');
  const begeleidingsInputs = document.querySelectorAll('.form-grid-seven > div:nth-child(1) input');

  let inkoopTotaal = 0;
  let verkoopTotaal = 0;

  inkoopInputs.forEach(input => {
    const bedrag = parseEuroString(input.value);
    if (!isNaN(bedrag)) inkoopTotaal += bedrag;
  });

  verkoopInputs.forEach((input, index) => {
    if (index === 0 && begeleidingsInputs[0]?.value.trim().toLowerCase() === 'bemiddeling stz') {
      verkoopTotaal += 75.00;
    } else {
      const bedrag = parseEuroString(input.value);
      if (!isNaN(bedrag)) verkoopTotaal += bedrag;
    }
  });

  const marge = verkoopTotaal - inkoopTotaal;

  document.getElementById('inkoop_totaal').value = inkoopTotaal ? `‚Ç¨ ${inkoopTotaal.toFixed(2).replace('.', ',')}` : '';
  document.getElementById('verkoop_totaal').value = verkoopTotaal ? `‚Ç¨ ${verkoopTotaal.toFixed(2).replace('.', ',')}` : '';
  document.getElementById('marge').value = marge ? `‚Ç¨ ${marge.toFixed(2).replace('.', ',')}` : '';
}

document.addEventListener('DOMContentLoaded', () => {
  const begeleidingsInputs = document.querySelectorAll('.form-grid-seven > div:nth-child(1) input');
  const urenInputs = document.querySelectorAll('.form-grid-seven > div:nth-child(5) input');
  const verkoopInputs = document.querySelectorAll('input[data-type="verkoop"]');
  const inkoopInputs = document.querySelectorAll('input[data-type="inkoop"]');

  // Regel 1: Bemiddeling STZ = vaste verkoopprijs 75,00
  if (begeleidingsInputs[0] && verkoopInputs[0]) {
    if (begeleidingsInputs[0].value.trim().toLowerCase() === 'bemiddeling stz') {
      verkoopInputs[0].value = '75,00';
    }
    begeleidingsInputs[0].addEventListener('input', () => {
      if (begeleidingsInputs[0].value.trim().toLowerCase() === 'bemiddeling stz') {
        verkoopInputs[0].value = '75,00';
        updateTotals();
      }
    });
  }

  // Berekening verkoopprijs via uren
  urenInputs.forEach((input, index) => {
    input.addEventListener('input', () => {
      const uren = parseFloat(input.value);
      if (!isNaN(uren)) {
        if (!(index === 0 && begeleidingsInputs[0].value.trim().toLowerCase() === 'bemiddeling stz')) {
          verkoopInputs[index].value = (uren * 62.5).toFixed(2).replace('.', ',');
        }
        updateTotals();
      }
    });
  });

  [...inkoopInputs, ...verkoopInputs].forEach(input => {
    input.addEventListener('blur', () => {
      const raw = input.value.trim();
      if (raw === '') {
        input.value = '';
        updateTotals();
        return;
      }
      const bedrag = parseEuroString(input.value);
      if (!isNaN(bedrag)) input.value = formatEuro(bedrag);
      updateTotals();
    });

    input.addEventListener('focus', () => {
      if (input.value === '0,00') input.value = '';
    });
  });

  updateTotals();
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
  async function genereerPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const refnummer = "2025." + (document.getElementById("referentienummer").value || "");
    const behandelaar = document.getElementById("behandelaar").value || "";
    const opdrachtgever = document.getElementById("opdrachtgever").value || "";
    const vervoerder = document.getElementById("vervoerder").value || "";
    const referentie = document.getElementById("referentie_klant").value || "";
    const omschrijving = document.getElementById("omschrijving").value || "";
    const opmerkingen = document.getElementById("opmerkingen_facturatie").value || "";
    const inkoop = document.getElementById("inkoop_totaal").value || "";
    const verkoop = document.getElementById("verkoop_totaal").value || "";
    const marge = document.getElementById("marge").value || "";

    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("BEGELEIDINGEN RAPPORT", 105, 15, { align: "center" });

    doc.setFontSize(11);

    const veld = (label, val, y) => {
      doc.setFont("helvetica", "bold");
      doc.text(`${label}`, 14, y);
      doc.setFont("helvetica", "normal");
      doc.text(val, 60, y);
    };

    let y = 25;
    veld("Referentienummer:", refnummer, y); y += 6;
    veld("Behandelaar:", behandelaar, y); y += 6;
    veld("Opdrachtgever:", opdrachtgever, y); y += 6;
    veld("Vervoerder:", vervoerder, y); y += 6;
    veld("Referentie klant:", referentie, y); y += 6;
    doc.setFont("helvetica", "bold");
    doc.text("Omschrijving:", 14, y); y += 6;
    doc.setFont("helvetica", "normal");
    doc.text(doc.splitTextToSize(omschrijving, 180), 14, y); y += 14;

    // Tabeldata
    const body = [];
    const kolommen = document.querySelectorAll(".form-grid-seven > div");

    for (let i = 0; i < 8; i++) {
      const rij = [];
      for (let j = 0; j < 7; j++) {
        let val = kolommen[j]?.querySelectorAll("input")[i]?.value || "";

        // Transportdatum formatteren
        if (j === 1 && val.includes("-")) {
          const [jaar, maand, dag] = val.split("-");
          val = `${dag}-${maand}-${jaar}`;
        }

        rij.push(val);
      }
      if (rij.some(v => v !== "")) {
        body.push(rij);
      }
    }

    doc.autoTable({
      startY: y,
      head: [["Firma", "Datum", "Van", "Naar", "Uren", "Inkoop (‚Ç¨)", "Verkoop (‚Ç¨)"]],
      body: body,
      styles: { fontSize: 10, cellPadding: 2 },
      theme: 'grid'
    });

    let eindY = doc.lastAutoTable.finalY + 10;
    veld("Inkoopprijs totaal:", inkoop, eindY); eindY += 6;
    veld("Verkoopprijs totaal:", verkoop, eindY); eindY += 6;
    veld("Marge:", marge, eindY); eindY += 10;

    doc.setFont("helvetica", "bold");
    doc.text("Opmerkingen t.a.v. facturatie:", 14, eindY);
    doc.setFont("helvetica", "normal");
    doc.text(doc.splitTextToSize(opmerkingen, 180), 14, eindY + 6);

    doc.save(`${refnummer || "begeleiding"}.pdf`);
  }
</script>


<footer>
  ¬©2025 - Ontwikkeld door Ren√© van Bavel - VMSbeheer.nl
</footer>


</body>
</html>



</body>
</html>

<!DOCTYPE html>

<html lang="nl">
<head>
<meta charset="utf-8"/>
<title>Speciaal Transport Zwolle B.V. - Begeleidingenrapport</title>
<link href="style.css" rel="stylesheet"/>
<link href="print.css" media="print" rel="stylesheet"/>
</head>
<body>
<header>
<img alt="Speciaal Transport Zwolle B.V." class="logo" src="logo.png"/>
<h1>SPECIAAL TRANSPORT ZWOLLE B.V. - BEGELEIDINGENRAPPORT</h1>
</header>
<nav class="top-menu">
<button onclick="window.location.href='index.html'">üè† HOME</button>
<button onclick="window.location.href='vergunningen.html'">INBOEKEN VERGUNNINGEN</button>
<button onclick="window.location.href='ontheffingenrapport.html'">BEGELEIDINGEN RAPPORT</button>
<button onclick="window.location.href='begeleidingenrapport.html'">BEGELEIDINGEN RAPPORT</button>
<button onclick="window.location.href='aanvraagtransportbegeleiding.html'">AANVRAAG TRANSPORTBEGELEIDING</button>
</nav>
<main class="card">
<h2>BEGELEIDINGEN RAPPORT</h2>
<div class="form-grid">
<label>Referentienummer:
            <div class="split-input">
<span class="prefix">2025.</span>
<input id="referentienummer" maxlength="4" placeholder="4 cijfers" type="text"/>
</div>
</label>
<label>Behandelaar:
            <select id="behandelaar">
<option value="">--- Maak keuze ---</option>
<option value="Ren√©">Ren√©</option>
<option value="Anke">Anke</option>
<option value="Sia">Sia</option>
<option value="Martijn">Martijn</option>
</select>
</label>
</div>
<div class="form-grid-three">
<label>Opdrachtgever:
            <input id="opdrachtgever" placeholder="Naam opdrachtgever" type="text"/>
</label>
<label>Vervoerder:
            <input id="vervoerder" placeholder="Naam vervoerder" type="text"/>
</label>
<label>Referentie klant:
            <input id="referentie_klant" placeholder="Referentie klant" type="text"/>
</label>
</div>
<div class="form-grid-single">
<label>Omschrijving:
            <textarea id="omschrijving" placeholder="Transport, voertuig, route, etc."></textarea>
</label>
</div>
<div class="form-grid-single">
<label>Opmerkingen t.a.v. facturatie:
            <textarea id="opmerkingen_facturatie" placeholder="Bijvoorbeeld factuurreferenties of betaalafspraken"></textarea>
</label>
</div>
<h3>Details per regel</h3>
<div class="form-grid-seven">
<div>
<label>Begeleidingsfirma:</label>
<input type="text" value="Bemiddeling STZ"/><input type="text"/><input type="text"/><input type="text"/>
<input type="text"/><input type="text"/><input type="text"/><input type="text"/>
</div>
<div>
<label>Transportdatum:</label>
<input type="date"/><input type="date"/><input type="date"/><input type="date"/>
<input type="date"/><input type="date"/><input type="date"/><input type="date"/>
</div>
<div>
<label>Van:</label>
<input type="text"/><input type="text"/><input type="text"/><input type="text"/>
<input type="text"/><input type="text"/><input type="text"/><input type="text"/>
</div>
<div>
<label>Naar:</label>
<input type="text"/><input type="text"/><input type="text"/><input type="text"/>
<input type="text"/><input type="text"/><input type="text"/><input type="text"/>
</div>
<div>
<label>Uren:</label>
<input type="number"/><input type="number"/><input type="number"/><input type="number"/>
<input type="number"/><input type="number"/><input type="number"/><input type="number"/>
</div>
<div>
<label>Inkoopprijs (‚Ç¨):</label>
<input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/>
<input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/>
</div>
<div>
<label>Verkoopprijs (‚Ç¨):</label>
<input step="0.01" type="number" value="75.00"/><input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/>
<input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/><input step="0.01" type="number"/>
</div>
</div>
<div class="form-grid-three">
<label>Inkoopprijs totaal (‚Ç¨):
            <input id="inkoop_totaal" readonly="" type="text"/>
</label>
<label>Verkoopprijs totaal (‚Ç¨):
            <input id="verkoop_totaal" readonly="" type="text"/>
</label>
<label>Marge (‚Ç¨):
            <input id="marge" readonly="" type="text"/>
</label>
</div>
<button class="primary-btn" onclick="opslaanBegeleiding()">OPSLAAN BEGELEIDINGSRAPPORT</button>
<button class="primary-btn" onclick="genereerPDF()">üì• DOWNLOAD ALS PDF</button>
<section id="pdf-view" style="display: none; font-family: Arial, sans-serif; font-size: 11pt; margin-top: 20px;">
<h2 style="text-align: center; margin-bottom: 10px;">BEGELEIDINGEN RAPPORT</h2>
<table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
<tr>
<td><strong>Referentienummer:</strong></td>
<td id="refnummer_pdf"></td>
<td><strong>Behandelaar:</strong></td>
<td id="behandelaar_pdf"></td>
</tr>
<tr>
<td><strong>Opdrachtgever:</strong></td>
<td id="opdrachtgever_pdf"></td>
<td><strong>Vervoerder:</strong></td>
<td id="vervoerder_pdf"></td>
</tr>
<tr>
<td><strong>Referentie klant:</strong></td>
<td colspan="3" id="referentie_pdf"></td>
</tr>
<tr>
<td><strong>Omschrijving:</strong></td>
<td colspan="3" id="omschrijving_pdf"></td>
</tr>
<tr>
<td><strong>Opmerkingen t.a.v. facturatie:</strong></td>
<td colspan="3" id="facturatie_pdf"></td>
</tr>
</table>
<h3 style="margin-top: 10px;">Details per regel</h3>
<table id="detail-tabel-pdf" style="width: 100%; border-collapse: collapse;">
<thead>
<tr>
<th style="border: 1px solid #000; padding: 5px;">Aangevraagd bij</th>
<th style="border: 1px solid #000; padding: 5px;">Aanvraagdatum</th>
<th style="border: 1px solid #000; padding: 5px;">Afgiftedatum</th>
<th style="border: 1px solid #000; padding: 5px;">Inkoopprijs (‚Ç¨)</th>
<th style="border: 1px solid #000; padding: 5px;">Verkoopprijs (‚Ç¨)</th>
</tr>
</thead>
<tbody id="detail-body-pdf">
<!-- Rijen worden dynamisch gevuld -->
</tbody>
</table>
<div style="margin-top: 15px;">
<strong>Inkoopprijs totaal:</strong> <span id="inkoop_pdf"></span><br/>
<strong>Verkoopprijs totaal:</strong> <span id="verkoop_pdf"></span><br/>
<strong>Marge:</strong> <span id="marge_pdf"></span>
</div>
</section>
<section class="card" id="opgeslagen-rapporten" style="margin-top: 30px;">
<h3>Opgeslagen opdrachten</h3>
<table id="begeleidingenTabel" style="width:100%; border-collapse: collapse;">
<thead>
<tr>
<th style="border-bottom: 1px solid #ccc; padding: 8px; text-align: left;">Referentienummer</th>
<th style="border-bottom: 1px solid #ccc; padding: 8px; text-align: left;">Opdrachtgever</th>
<th style="border-bottom: 1px solid #ccc; padding: 8px; text-align: left;">Actie</th>
</tr>
</thead>
<tbody>
<!-- Dynamisch gevuld met opgeslagen rapporten -->
</tbody>
</table>
</section>
</main>
<footer>
    Ontwikkeld door Ren√© van Bavel ¬©2025 Speciaal Transport Zwolle B.V.
</footer>
<script>
document.addEventListener('input', () => {
  const inkoopInputs = document.querySelectorAll('.form-grid-seven > div:nth-child(6) input[type="number"]');
  const verkoopInputs = document.querySelectorAll('.form-grid-seven > div:nth-child(7) input[type="number"]');

  let inkoopTotaal = 0;
  let verkoopTotaal = 0;

  inkoopInputs.forEach(input => {
    const waarde = parseFloat(input.value);
    if (!isNaN(waarde)) {
      inkoopTotaal += waarde;
    }
  });

  verkoopInputs.forEach(input => {
    const waarde = parseFloat(input.value);
    if (!isNaN(waarde)) {
      verkoopTotaal += waarde;
    }
  });

  const marge = verkoopTotaal - inkoopTotaal;
  const format = waarde => `‚Ç¨ ${waarde.toFixed(2)}`;

  document.getElementById('inkoop_totaal').value = format(inkoopTotaal);
  document.getElementById('verkoop_totaal').value = format(verkoopTotaal);
  document.getElementById('marge').value = format(marge);
});

document.addEventListener('DOMContentLoaded', () => {
  // Force trigger input event to calculate totals on page load
  const firstVerkoopInput = document.querySelector('.form-grid-seven > div:nth-child(7) input[type="number"]');
  if (firstVerkoopInput) {
    const event = new Event('input', { bubbles: true });
    firstVerkoopInput.dispatchEvent(event);
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function genereerPDF() {
  vulPdfVelden();
  const element = document.getElementById("pdf-view");
  element.style.display = "block";

  requestAnimationFrame(() => {
    setTimeout(() => {
      const refnummer = document.getElementById("referentienummer")?.value || "rapport";
      html2pdf().from(element).save(refnummer + ".pdf");
    }, 300);
  });

  const element = document.getElementById("pdf-view"); element.style.display = "block";
  const opt = {
    margin:       0.5,
    filename:     'rapport.pdf',
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).then(() => {
    const refnummer = document.getElementById('referentienummer')?.value || 'rapport';
    html2pdf().from(element).save(refnummer + '.pdf');
  });
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function genereerPDF() {
  vulPdfVelden();
  const element = document.getElementById("pdf-view");
  element.style.display = "block";

  requestAnimationFrame(() => {
    setTimeout(() => {
      const refnummer = document.getElementById("referentienummer")?.value || "rapport";
      html2pdf().from(element).save(refnummer + ".pdf");
    }, 300);
  });

  const element = document.getElementById("pdf-view"); element.style.display = "block";
  const opt = {
    margin: [0.2, 0.2, 0.2, 0.2],
    
    const refnummer = document.getElementById('referentienummer')?.value;
    const prefix = refnummer ? `rapport_${refnummer.replace(/\D/g, '')}` : 'rapport';
    
    const refnummer = document.getElementById('referentienummer')?.value;
    const filename = refnummer ? `${refnummer}.pdf` : 'rapport.pdf';
    
        
        
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
  };
  html2pdf().set(opt).from(element).then(() => {
    const refnummer = document.getElementById('referentienummer')?.value || 'rapport';
    html2pdf().from(element).save(refnummer + '.pdf');
  });
}
</script>
<script>
function vulPdfVelden() {
  console.log("PDF-blok vullen gestart");

  document.getElementById("refnummer_pdf").innerText = document.getElementById("referentienummer")?.value || "";
  document.getElementById("behandelaar_pdf").innerText = document.getElementById("behandelaar")?.value || "";
  document.getElementById("opdrachtgever_pdf").innerText = document.getElementById("opdrachtgever")?.value || "";
  document.getElementById("vervoerder_pdf").innerText = document.getElementById("vervoerder")?.value || "";
  document.getElementById("referentie_pdf").innerText = document.getElementById("referentie_klant")?.value || "";
  document.getElementById("omschrijving_pdf").innerText = document.getElementById("omschrijving")?.value || "";
  document.getElementById("facturatie_pdf").innerText = document.getElementById("opmerkingen_facturatie")?.value || "";

  const inkoop = document.getElementById("inkoop_totaal")?.value || "";
  const verkoop = document.getElementById("verkoop_totaal")?.value || "";
  const marge = document.getElementById("marge")?.value || "";

  document.getElementById("inkoop_pdf").innerText = inkoop;
  document.getElementById("verkoop_pdf").innerText = verkoop;
  document.getElementById("marge_pdf").innerText = marge;

  // Rijen ophalen
  const tabelBody = document.getElementById("detail-body-pdf");
  tabelBody.innerHTML = "";

  const rijen = 8;
  for (let i = 0; i < rijen; i++) {
    const aangevraagd = document.querySelectorAll(".form-grid-five > div:nth-child(1) input")[i]?.value || "";
    const aanvraagdatum = document.querySelectorAll(".form-grid-five > div:nth-child(2) input")[i]?.value || "";
    const afgiftedatum = document.querySelectorAll(".form-grid-five > div:nth-child(3) input")[i]?.value || "";
    const inkoop = document.querySelectorAll(".form-grid-five > div:nth-child(4) input")[i]?.value || "";
    const verkoop = document.querySelectorAll(".form-grid-five > div:nth-child(5) input")[i]?.value || "";

    const rij = document.createElement("tr");
    rij.innerHTML = `
      <td style='border:1px solid #000; padding:5px;'>${aangevraagd}</td>
      <td style='border:1px solid #000; padding:5px;'>${aanvraagdatum}</td>
      <td style='border:1px solid #000; padding:5px;'>${afgiftedatum}</td>
      <td style='border:1px solid #000; padding:5px;'>${inkoop}</td>
      <td style='border:1px solid #000; padding:5px;'>${verkoop}</td>
    `;
    tabelBody.appendChild(rij);
  }
}
</script>
<!-- jsPDF & autoTable CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
async function genereerPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Basisdata ophalen
  const prefix = document.querySelector(".split-input .prefix")?.textContent || "";
  const nummer = document.querySelector(".split-input input")?.value || "";
  const refnummer = prefix + nummer;

  const behandelaar = document.getElementById("behandelaar")?.value || "";
  const opdrachtgever = document.getElementById("opdrachtgever")?.value || "";
  const vervoerder = document.getElementById("vervoerder")?.value || "";
  const referentie = document.getElementById("referentie_klant")?.value || "";
  const omschrijving = document.getElementById("omschrijving")?.value || "";
  const opmerkingen = document.getElementById("opmerkingen_facturatie")?.value || "";

  const inkoop = document.getElementById("inkoop_totaal")?.value || "";
  const verkoop = document.getElementById("verkoop_totaal")?.value || "";
  const marge = document.getElementById("marge")?.value || "";

  // Kop
  doc.setFontSize(14);
  doc.text("BEGELEIDINGEN RAPPORT", 105, 15, { align: "center" });
  doc.setFontSize(11);
  doc.text(`Referentienummer: ${refnummer}`, 14, 25);
  doc.text(`Behandelaar: ${behandelaar}`, 110, 25);
  doc.text(`Opdrachtgever: ${opdrachtgever}`, 14, 32);
  doc.text(`Vervoerder: ${vervoerder}`, 110, 32);
  doc.text(`Referentie klant: ${referentie}`, 14, 39);
  doc.text("Omschrijving:", 14, 46);
  doc.text(doc.splitTextToSize(omschrijving, 180), 14, 52);
  doc.text("Opmerkingen t.a.v. facturatie:", 14, 72);
  doc.text(doc.splitTextToSize(opmerkingen, 180), 14, 78);

  // Tabelgegevens verzamelen
  const body = [];
  const kolommen = document.querySelectorAll(".form-grid-seven > div");
  for (let i = 0; i < 8; i++) {
    const rij = [];
    for (let j = 0; j < 7; j++) {
      if (j === 0 && i === 0) {
          rij.push("Bemiddeling STZ");
        } else if (j === 6 && i === 0) {
          rij.push("75,00");
        } else {
          rij.push(kolommen[j]?.querySelectorAll("input")[i]?.value || "");
        }
    }
    if (rij.some(val => val !== "")) {
      body.push(rij);
    }
  }

  // Voeg tabel toe
  doc.autoTable({
    startY: 95,
    head: [["Begeleidingsfirma", "Datum", "Tijd", "Verzameladres", "Losadres", "Inkoopprijs (‚Ç¨)", "Verkoopprijs (‚Ç¨)"]],
    body: body,
    styles: { fontSize: 10, cellPadding: 2 },
    theme: 'grid'
  });

  // Totale bedragen
  let eindY = doc.lastAutoTable.finalY + 10;
  doc.text(`Inkoopprijs totaal: ${inkoop}`, 14, eindY);
  doc.text(`Verkoopprijs totaal: ${verkoop}`, 14, eindY + 6);
  doc.text(`Marge: ${marge}`, 14, eindY + 12);

  // Opslaan
  doc.save(`${refnummer || "rapport"}.pdf`);
}
</script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhYR1OuoDaIFeN4-JITfyTdsleadSMTNo",
  authDomain: "vergunningenapp-8455e.firebaseapp.com",
  projectId: "vergunningenapp-8455e",
  storageBucket: "vergunningenapp-8455e.appspot.com",
  messagingSenderId: "882694266288",
  appId: "1:882694266288:web:832a85a80dea1b6190ca75"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.opslaanBegeleiding = async function () {
  const refnummer = document.querySelector(".split-input input")?.value;
  const opdrachtgever = document.getElementById("opdrachtgever")?.value;

  if (!refnummer || !opdrachtgever) {
    alert("Vul minimaal het referentienummer en de opdrachtgever in.");
    return;
  }

  const data = {
    behandelaar: document.getElementById("behandelaar")?.value || "",
    opdrachtgever,
    vervoerder: document.getElementById("vervoerder")?.value || "",
    referentie: document.getElementById("referentie_klant")?.value || "",
    omschrijving: document.getElementById("omschrijving")?.value || "",
    opmerkingen: document.getElementById("opmerkingen_facturatie")?.value || "",
    timestamp: new Date()
  };

  try {
    await setDoc(doc(db, "begeleidingen", `2025.${refnummer}`), data);
    alert("Begeleidingsrapport opgeslagen.");
    laadBegeleidingen();
  } catch (e) {
    console.error("Fout bij opslaan:", e);
  }
}

window.laadBegeleidingen = async function () {
  const tbody = document.querySelector("#begeleidingenTabel tbody");
  tbody.innerHTML = "";

  const snap = await getDocs(collection(db, "begeleidingen"));
  snap.forEach(docSnap => {
    const data = docSnap.data();
    const row = document.createElement("tr");
    row.innerHTML = `
      <td style="padding: 8px;">${docSnap.id}</td>
      <td style="padding: 8px;">${data.opdrachtgever}</td>
      <td style="padding: 8px;">
        <button onclick="bewerkBegeleiding('${docSnap.id}')" class="primary-btn small">Bewerk opdracht</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

window.bewerkBegeleiding = async function (ref) {
  const snap = await getDoc(doc(db, "begeleidingen", ref));
  if (!snap.exists()) return alert("Gegevens niet gevonden.");

  const data = snap.data();
  const nummer = ref.split(".")[1];

  document.querySelector(".split-input input").value = nummer;
  document.getElementById("behandelaar").value = data.behandelaar || "";
  document.getElementById("opdrachtgever").value = data.opdrachtgever || "";
  document.getElementById("vervoerder").value = data.vervoerder || "";
  document.getElementById("referentie_klant").value = data.referentie || "";
  document.getElementById("omschrijving").value = data.omschrijving || "";
  document.getElementById("opmerkingen_facturatie").value = data.opmerkingen || "";
}
document.addEventListener("DOMContentLoaded", laadBegeleidingen);
</script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDoc, getDocs, collection
} from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhYR1OuoDaIFeN4-JITfyTdsleadSMTNo",
  authDomain: "vergunningenapp-8455e.firebaseapp.com",
  projectId: "vergunningenapp-8455e",
  storageBucket: "vergunningenapp-8455e.appspot.com",
  messagingSenderId: "882694266288",
  appId: "1:882694266288:web:832a85a80dea1b6190ca75"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function verzamelRegelData() {
  const kolommen = document.querySelectorAll(".form-grid-seven > div");
  const regels = [];

  for (let i = 0; i < 8; i++) {
    regels.push({
      firma: kolommen[0].querySelectorAll("input")[i]?.value || "",
      datum: kolommen[1].querySelectorAll("input")[i]?.value || "",
      van: kolommen[2].querySelectorAll("input")[i]?.value || "",
      naar: kolommen[3].querySelectorAll("input")[i]?.value || "",
      uren: kolommen[4].querySelectorAll("input")[i]?.value || "",
      inkoop: kolommen[5].querySelectorAll("input")[i]?.value || "",
      verkoop: kolommen[6].querySelectorAll("input")[i]?.value || ""
    });
  }

  return regels;
}

function vulRegelData(regels) {
  const kolommen = document.querySelectorAll(".form-grid-seven > div");

  for (let i = 0; i < regels.length && i < 8; i++) {
    kolommen[0].querySelectorAll("input")[i].value = regels[i].firma || "";
    kolommen[1].querySelectorAll("input")[i].value = regels[i].datum || "";
    kolommen[2].querySelectorAll("input")[i].value = regels[i].van || "";
    kolommen[3].querySelectorAll("input")[i].value = regels[i].naar || "";
    kolommen[4].querySelectorAll("input")[i].value = regels[i].uren || "";
    kolommen[5].querySelectorAll("input")[i].value = regels[i].inkoop || "";
    kolommen[6].querySelectorAll("input")[i].value = regels[i].verkoop || "";
  }
}

window.opslaanBegeleiding = async function () {
  const refnummer = document.querySelector(".split-input input")?.value;
  const opdrachtgever = document.getElementById("opdrachtgever")?.value;

  if (!refnummer || !opdrachtgever) {
    alert("Vul minimaal het referentienummer en de opdrachtgever in.");
    return;
  }

  const data = {
    behandelaar: document.getElementById("behandelaar")?.value || "",
    opdrachtgever,
    vervoerder: document.getElementById("vervoerder")?.value || "",
    referentie: document.getElementById("referentie_klant")?.value || "",
    omschrijving: document.getElementById("omschrijving")?.value || "",
    opmerkingen: document.getElementById("opmerkingen_facturatie")?.value || "",
    regels: verzamelRegelData(),
    timestamp: new Date()
  };

  try {
    await setDoc(doc(db, "begeleidingen", `2025.${refnummer}`), data);
    alert("Begeleidingsrapport opgeslagen.");
    laadBegeleidingen();
  } catch (e) {
    console.error("Fout bij opslaan:", e);
  }
}

window.bewerkBegeleiding = async function (ref) {
  const snap = await getDoc(doc(db, "begeleidingen", ref));
  if (!snap.exists()) return alert("Gegevens niet gevonden.");

  const data = snap.data();
  const nummer = ref.split(".")[1];

  document.querySelector(".split-input input").value = nummer;
  document.getElementById("behandelaar").value = data.behandelaar || "";
  document.getElementById("opdrachtgever").value = data.opdrachtgever || "";
  document.getElementById("vervoerder").value = data.vervoerder || "";
  document.getElementById("referentie_klant").value = data.referentie || "";
  document.getElementById("omschrijving").value = data.omschrijving || "";
  document.getElementById("opmerkingen_facturatie").value = data.opmerkingen || "";
  if (data.regels) {
    vulRegelData(data.regels);
  }
}

window.laadBegeleidingen = async function () {
  const tbody = document.querySelector("#begeleidingenTabel tbody");
  tbody.innerHTML = "";

  const snap = await getDocs(collection(db, "begeleidingen"));
  snap.forEach(docSnap => {
    const data = docSnap.data();
    const row = document.createElement("tr");
    row.innerHTML = `
      <td style="padding: 8px;">${docSnap.id}</td>
      <td style="padding: 8px;">${data.opdrachtgever}</td>
      <td style="padding: 8px;">
        <button onclick="bewerkBegeleiding('${docSnap.id}')" class="primary-btn small">Bewerk opdracht</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}
document.addEventListener("DOMContentLoaded", laadBegeleidingen);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
async function genereerPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const prefix = document.querySelector(".split-input .prefix")?.textContent || "";
  const nummer = document.querySelector(".split-input input")?.value || "";
  const refnummer = prefix + nummer;

  const behandelaar = document.getElementById("behandelaar")?.value || "";
  const opdrachtgever = document.getElementById("opdrachtgever")?.value || "";
  const vervoerder = document.getElementById("vervoerder")?.value || "";
  const referentie = document.getElementById("referentie_klant")?.value || "";
  const omschrijving = document.getElementById("omschrijving")?.value || "";
  const opmerkingen = document.getElementById("opmerkingen_facturatie")?.value || "";

  const inkoop = document.getElementById("inkoop_totaal")?.value || "";
  const verkoop = document.getElementById("verkoop_totaal")?.value || "";
  const marge = document.getElementById("marge")?.value || "";

  doc.setFontSize(14);
  doc.text("BEGELEIDINGEN RAPPORT", 105, 15, { align: "center" });
  doc.setFontSize(11);
  doc.text(`Referentienummer: ${refnummer}`, 14, 25);
  doc.text(`Behandelaar: ${behandelaar}`, 110, 25);
  doc.text(`Opdrachtgever: ${opdrachtgever}`, 14, 32);
  doc.text(`Vervoerder: ${vervoerder}`, 110, 32);
  doc.text(`Referentie klant: ${referentie}`, 14, 39);
  doc.text("Omschrijving:", 14, 46);
  doc.text(doc.splitTextToSize(omschrijving, 180), 14, 52);
  doc.text("Opmerkingen t.a.v. facturatie:", 14, 72);
  doc.text(doc.splitTextToSize(opmerkingen, 180), 14, 78);

  // Tabelgegevens
  const body = [];
  const kolommen = document.querySelectorAll(".form-grid-seven > div");
  for (let i = 0; i < 8; i++) {
    const rij = [];
    for (let j = 0; j < 7; j++) {
      rij.push(kolommen[j]?.querySelectorAll("input")[i]?.value || "");
    }
    if (rij.some(val => val !== "")) {
      body.push(rij);
    }
  }

  doc.autoTable({
    startY: 95,
    head: [["Begeleidingsfirma", "Transportdatum", "Van", "Naar", "Uren", "Inkoopprijs (‚Ç¨)", "Verkoopprijs (‚Ç¨)"]],
    body: body,
    styles: { fontSize: 10, cellPadding: 2 },
    theme: 'grid'
  });

  const eindY = doc.lastAutoTable.finalY + 10;
  doc.text(`Inkoopprijs totaal: ${inkoop}`, 14, eindY);
  doc.text(`Verkoopprijs totaal: ${verkoop}`, 14, eindY + 6);
  doc.text(`Marge: ${marge}`, 14, eindY + 12);

  doc.save(`${refnummer || "rapport"}.pdf`);
}
</script>
</body>
</html>
